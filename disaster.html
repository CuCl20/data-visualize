<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>disaster visualize</title>
  <script src="libs/d3.v7.js"></script>
</head>


<body>
    <script>
    // 设置地理投影
    var projection = d3.geoMercator()
            .scale(200)  // 调整缩放值
            .center([66, 35])  // 调整中心点坐标
            .translate([400, 300]);

        // 创建路径生成器
        var path = d3.geoPath().projection(projection);

        // 创建 SVG 容器
        var svg = d3.select("body").append("svg")
            .attr("width", 800)
            .attr("height", 600);

        // 加载 GeoJSON 数据
        d3.json('output.geojson').then(function(data) {
            // 绘制地图
            svg.selectAll('path')
                .data(data.features)
                .enter().append('path')
                .attr('d', path)
                .style('fill', 'steelblue')
                .style('stroke', 'white');  // 添加白色边框
                d3.csv('typhoon.csv').then(function (typhoonData) {
            // 将经纬度坐标映射到地理坐标
            typhoonData = typhoonData.slice(0, 500);
            var typhoonPoints = typhoonData.map(function (d) {
                return {
                    id: d.台风编号,
                    coordinates: [parseFloat(d.经度), parseFloat(d.纬度)]
                };
            });
            console.log(typhoonPoints)

            // 在地图上标记台风数据
            svg.selectAll('circle')
                .data(typhoonPoints)
                .enter().append('circle')
                .attr('cx', function (d) { return projection(d.coordinates)[0]; })
                .attr('cy', function (d) { return projection(d.coordinates)[1]; })
                .attr('r', 1)  // 圆点半径
                .style('fill', 'red');  // 圆点颜色

            // 绘制连接线，不连接不同台风之间的点
            svg.selectAll('line')
            .data(d3.pairs(typhoonPoints))  // 使用d3.pairs生成相邻点的对
            .enter().append('line')
            .attr('x1', function(d) {
                // 如果两点属于同一台风，则连接
                if (d[0].id === d[1].id) {
                    return projection(d[0].coordinates)[0];
                }
            })
            .attr('y1', function(d) {
                // 如果两点属于同一台风，则连接
                if (d[0].id === d[1].id) {
                    return projection(d[0].coordinates)[1];
                }
            })
            .attr('x2', function(d) {
                // 如果两点属于同一台风，则连接
                if (d[0].id === d[1].id) {
                    return projection(d[1].coordinates)[0];
                }
            })
            .attr('y2', function(d) {
                // 如果两点属于同一台风，则连接
                if (d[0].id === d[1].id) {
                    return projection(d[1].coordinates)[1];
                }
            })
            .style('stroke', 'blue');  // 线的颜色
        });
        }).catch(function(error) {
            console.error('Error loading GeoJSON:', error);
        });

    </script>
</body>